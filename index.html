<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Key Generator</title>
<style>
body {
    margin:0;
    height:100vh;
    font-family: Arial;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background: linear-gradient(135deg,#1f1f1f,#3a3a3a);
    color:white;
}
button {
    padding:12px 25px;
    font-size:17px;
    border:none;
    border-radius:10px;
    margin:10px;
    cursor:pointer;
    transition:0.2s;
    color:white;
}
#genBtn { background:#4a90e2; }
#copyBtn { background:#50e3c2; display:none; }
#show { margin-top:20px; font-size:18px; text-align:center; }

@media(max-width:600px){
    button { width:90%; }
}
</style>
</head>
<body>

<h1>Secure Key Generator</h1>

<button id="genBtn">Tạo Key</button>
<button id="copyBtn">Sao chép Key</button>
<div id="show"></div>

<script>

// Fingerprint nhẹ
async function getFingerprint(){
    let data = navigator.userAgent + screen.width + screen.height + navigator.language;
    let hashBuffer = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(data));
    let hex = Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,"0")).join("");
    return hex.slice(0,16);
}

// Hàm encode tránh đoán key
function deepEncode(str){
    return btoa(btoa(str).split("").reverse().join(""));
}

async function generateKey(){
    let fp = await getFingerprint();

    let date = new Date().toISOString().slice(0,10);

    let raw = fp + "_" + date;

    let encoded = deepEncode(raw);

    // Key rút gọn dài 18 ký tự
    return encoded.slice(0,18);
}

document.getElementById("genBtn").onclick = async ()=>{

    let key = await generateKey();

    let expire = Date.now() + 24*60*60*1000;

    localStorage.setItem("KEY", key);
    localStorage.setItem("KEY_EXPIRE", expire);

    document.getElementById("show").innerText =
        "Key: " + key + "\nHết hạn: 24 giờ kể từ bây giờ";

    document.getElementById("copyBtn").style.display = "inline-block";
};

document.getElementById("copyBtn").onclick = ()=>{
    let key = localStorage.getItem("KEY");
    navigator.clipboard.writeText(key);
    alert("Đã sao chép key!");
};

</script>
</body>
</html>
